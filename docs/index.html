<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<style>  
    div.padded {  
      padding-top: 0px;  
      padding-right: 100px;  
      padding-bottom: 0.25in;  
      padding-left: 100px;  
    }  
  </style> 
<title>Your Name  |  CS 184</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="style.css" media="screen" />
</head>
<body>
<br />
<h1 align="middle">Assignment 3: PathTracer</h1>
    <h2 align="middle">Ruixin Huang cs184-aed</h2>

    <div class="padded">
        <p>This project explores the how ray is generated and how do they interact with objects to create the rendered scene we often see.
            Throught this project, I explored the different way of illumination for a scene and how to make it look better and work faster. 
        </p>
        <h2 align="middle">Part 1: Ray Generation and Intersection</h2>
        <p> ray generation and primitive intersection parts of the rendering pipeline:
            we define a sensor plane which maps (0,0) to the bottom left and (1,1) to the top right.
            And we use lerp as we did in the previous project to find the corresponding input points in the 
            camera space. Then we apply c2w matrix to transform it into world space. For each pixel, we either take
            multiple smaples and average them or we just cast a single ray through the center of the pixel.


        </p>

        <p>Explain the triangle intersection algorithm you implemented in your own words : the intersection must satisify two equations : the one of the ray and the one of the triangle.
           the triangle is represented with barycentric coordinates. We solved for the intersection and check if it's vlaid.
        </p>
        <div align="center">
            <table style="width=100%">
                <tr>
                    <br>
                        <td align="middle">
                        <img src="q1/CBcoil_screenshot_3-12_12-18-5.png" width="480px" />
                        <figcaption align="middle">coil</figcaption>
                    </br>
                    <br>
                        <td align="middle">
                        <img src="q1/CBspheres_lambertian_screenshot_3-12_12-15-16.png" width="480px" />
                        <figcaption align="middle">spheres</figcaption>
                    </br>
                </tr>
                 <tr>
                    <br>
                        <td align="middle">
                        <img src="q1/teapot_screenshot_3-12_12-17-26.png" width="480px" />
                        <figcaption align="middle">teapot</figcaption>
                    </br>
                </tr>
            </table>
        </div>


        <h2 align="middle">Part 2: Bounding Volume Hierarchy</h2>

        <p> BVH construction algorithm:</p>
        <p> First, I pick the dimension to split on by comparing x, y, z axis value and pick the largest one. I then split all the 
            prims into two vectors, left and right, based on their centroid and current bounding box's centroid. I then build the two bounding box 
            of left and right by using the same method recursively. </p>

        <p>BVH intersection algorithm:</p>
        <p>I test if a ray intersects the prims by using the bounding box. I checked to see if there's 
            intersections between the three intervals (xmin,xmax),(ymin,ymax),(zmin,zmax). If the ray does hit a bounding box, I check if it's a 
            leaf node. If it's a leaf node, I check all the prims the node points to, otherwise, I check all its children.

        <div align="center">
            <table style="width=100%">
                <tr>
                    <br>
                        <td align="middle">
                        <img src="q2/CBdragon_screenshot_3-12_12-14-34.png" width="480px" />
                        <figcaption align="middle">dragon.</figcaption>
                    </br>
                    <br>
                        <td align="middle">
                        <img src="q2/CBlucy_screenshot_3-12_12-13-22.png" width="480px" />
                        <figcaption align="middle">angle.</figcaption>
                    </br>
                </tr>
                 <tr>
                    <br>
                        <td align="middle">
                        <img src="q2/maxplanck_screenshot_3-9_17-32-53.png" width="480px" />
                        <figcaption align="middle">maxplanck.</figcaption>
                    </br>
                </tr>
            </table>
        </div>
        

        <p>In general, I see a significant speed increase. And the increase in speed is more noticable in large files.</p>


        <h2 align="middle">Part 3: Direct Illumination</h2>
    

        <p> Uniform hemisphere sampling: sample the hemisphere originated at the hit point uniformluy at random and form a ray.
            If there's an intersction between the ray and objects in the scene, caculate emission from the intersection point. Scale it to 
            the right value and add it to the output.
         </p>
         <p>lightening sampling : Create a shadow ray originated at the hit point with a small offset,
             check to see if this ray intersects with any other objects in the scene before it reaches the 
             sampled location. And check if it's a delta light to determine the number of samples. If it doesn't 
             hit any object, we calculate the value and divide by the probablity to make it unbiased, then we the value to
             the output. At last, we just take the avergae of the output given the number of samples.
         </p>
        
        <div align="center">
            <table style="width=100%">
                <tr>
                    <br>
                        <td align="middle">
                        <img src="part3/bunny_64_32U.png" width="480px" />
                        <figcaption align="middle"> Bunny.dae, uniform hemisphere sampling.</figcaption>
                    </br>
                    <br>
                        <td align="middle">
                        <img src="part3/bunny_64_32.png" width="480px" />
                        <figcaption align="middle"> Bunny.dae, light sampling.</figcaption>
                    </br>
                </tr>
                 <tr>
                    
                    <br>
                        <td align="middle">
                        <img src="part3/dragon_64_32.png" width="480px" />
                        <figcaption align="middle"> Dragon.dae,light sampling.</figcaption>
                    </br>
                </tr>
            </table>
        </div>

        <p>spheres.dae : compare the noise levels in soft shadows when rendering with 1, 4, 16, and 64 light rays (the -l flag) and 1 sample per pixel (the -s flag) using light sampling, not uniform hemisphere sampling.</p>
        <div align="center">
            <table style="width=100%">
                <tr>
                    <br>
                        <td align="middle">
                        <img src="part3/sphere3_1_1.png" width="480px" />
                        <figcaption align="middle"> s = 1, l = 1.</figcaption>
                    </br>
                    <br>
                        <td align="middle">
                        <img src="part3/sphere3_1_4.png" width="480px" />
                        <figcaption align="middle"> s = 1, l = 4.</figcaption>
                    </br>
                </tr>
                 <tr>
                    <br>
                        <td align="middle">
                        <img src="part3/sphere3_1_16.png" width="480px" />
                        <figcaption align="middle"> s = 1, l = 16.</figcaption>
                    </br>
                    <br>
                        <td align="middle">
                        <img src="part3/sphere3_1_64.png" width="480px" />
                        <figcaption align="middle"> s = 1, l = 64.</figcaption>
                    </br>
                </tr>
            </table>
        </div>
       <p>
            it's harder for uniform hemisphere sampling to converge, it requires a higher number of 
            sample per pixel and ray per pixel. In general, we get better results using lightening sampling. It has less noise than uniform sampling.

       </p><div align="center">
            <table style="width=100%">
                 <tr>
                    <br>
                        <td align="middle">
                        <img src="part3/bunny_64_32U.png" width="480px" />
                        <figcaption align="middle"> Uniform hemisphere sampling, s = 64, l = 32.</figcaption>
                    </br>
                    <br>
                        <td align="middle">
                        <img src="part3/bunny_64_32.png" width="480px" />
                        <figcaption align="middle"> Lighting sampling, s = 64, l = 32.</figcaption>
                    </br>
                </tr>
                <tr>
                        <br>
                            <td align="middle">
                            <img src="part3/bunny_128_64U.png" width="480px" />
                            <figcaption align="middle"> Uniform hemisphere sampling, s = 128, l = 64.</figcaption>
                        </br>
                        <br>
                            <td align="middle">
                            <img src="part3/bunny_128_64.png" width="480px" />
                            <figcaption align="middle"> Lighting sampling, s = 128, l = 64.</figcaption>
                        </br>
                    </tr>
            </table>
        </div>


        <h2 align="middle">Part 4: Global Illumination</h2>
        
        <p> The indirect lightening part calls the one_bounce_randiance function first,
            then based on the hit point,it samples a random direction and formes a new Ray in the direction and recursively trace that 
            Ray. The new ray will have a new hit point, and a depth of the original ray plus one. We keep track of the depth
            of the ray so it won't loop forever. And we also use Russian Roulette to determine the probably of termination
            when the depth is the maximum of what we want. If we haven't reached the maximum depth yet, we recursively call at_least_one_bounce
            with probablity one. If we have reached the maximum depth, we use Russion Roulette to determine if we keep going.
        </p>
        <div align="center">
            <table style="width=100%">
                <tr>
                    <br>
                        <td align="middle">
                        <img src="part4/banan.png" width="480px" />
                        <figcaption align="middle"> Banana.</figcaption>
                    </br>
                    <br>
                        <td align="middle">
                        <img src="part4/spheres1024.png" width="480px" />
                        <figcaption align="middle"> Spheres.</figcaption>
                    </br>
                </tr>
                 <tr>
                    <br>
                        <td align="middle">
                        <img src="part4/bunny.png" width="480px" />
                        <figcaption align="middle"> Bunny.</figcaption>
                    </br>
                    <br>
                        <td align="middle">
                        <img src="part4/building.png" width="480px" />
                        <figcaption align="middle"> Building.</figcaption>
                    </br>
                </tr>
            </table>
        </div>

        <p>banana.dae with direct and indirect illumination.</p>
        <div align="center">
            <table style="width=100%">
                <tr>
                    <br>
                        <td align="middle">
                        <img src="part4/banana_16_8_part4.png" width="480px" />
                        <figcaption align="middle"> Direct illumination. s = 16, l = 8.</figcaption>
                    </br>
                    <br>
                        <td align="middle">
                        <img src="part4/banana_16_8_indpart4.png" width="480px" />
                        <figcaption align="middle"> Indirect illumination. s = 16, l = 8.</figcaption>
                    </br>
                </tr>
                 <tr>
                    <br>
                        <td align="middle">
                        <img src="part4/banana_32_16_part4.png" width="480px" />
                        <figcaption align="middle"> Direct illumination. s = 32, l = 16.</figcaption>
                    </br>
                    <br>
                        <td align="middle">
                        <img src="part4/banana_32_16__indpart4.png" width="480px" />
                        <figcaption align="middle"> Indirect illumination. s = 32, l = 16.</figcaption>
                    </br>
                </tr>
                <tr>
                    <br>
                        <td align="middle">
                        <img src="part4/banana_64_32.png" width="480px" />
                        <figcaption align="middle"> Direct illumination. s = 64, l = 32.</figcaption>
                    </br>
                    <br>
                        <td align="middle">
                        <img src="part4/banana_64_32__indpart4.png" width="480px" />
                        <figcaption align="middle"> Indirect illumination. s = 64, l = 32.</figcaption>
                    </br>
                </tr>
            </table>
        </div>
       

        <p> CBbunny.dae with different max depth.</p>

        <div align="center">
            <table style="width=100%">
                <tr>
                    <br>
                        <td align="middle">
                        <img src="part4/bunny_m_0.png" width="480px" />
                        <figcaption align="middle">max_rap_depth = 0.</figcaption>
                    </br>
                    <br>
                        <td align="middle">
                        <img src="part4/bunny_m_1.png" width="480px" />
                        <figcaption align="middle">max_rap_depth = 1.</figcaption>
                    </br>
                </tr>
                 <tr>
                    <br>
                        <td align="middle">
                        <img src="part4/bunny_m_2.png" width="480px" />
                        <figcaption align="middle">max_rap_depth = 2.</figcaption>
                    </br>
                    <br>
                        <td align="middle">
                        <img src="part4/bunny_m_3.png" width="480px" />
                        <figcaption align="middle">max_rap_depth = 3.</figcaption>
                    </br>
                </tr>
                <tr>
                    <br>
                        <td align="middle">
                        <img src="part4/bunny_m_100.png" width="480px" />
                        <figcaption align="middle">max_rap_depth = 100.</figcaption>
                    </br>
                </tr>
            </table>
        </div>


        <p>spheres.dae with diffeent sample rates..</p>

        <div align="center">
            <table style="width=100%">
                <tr>
                    <br>
                        <td align="middle">
                        <img src="part4/spheres_s1.png" width="480px" />
                        <figcaption align="middle">s = 1.</figcaption>
                    </br>
                    <br>
                        <td align="middle">
                        <img src="part4/spheres_s2.png" width="480px" />
                        <figcaption align="middle">s= 2.</figcaption>
                    </br>
                </tr>
                 <tr>
                    <br>
                        <td align="middle">
                        <img src="part4/spheres_s4.png" width="480px" />
                        <figcaption align="middle">s = 4.</figcaption>
                    </br>
                    <br>
                        <td align="middle">
                        <img src="part4/spheres_s8.png" width="480px" />
                        <figcaption align="middle">s = 8.</figcaption>
                    </br>
                </tr>
                <tr>
                    <br>
                        <td align="middle">
                        <img src="part4/spheres_s16.png" width="480px" />
                        <figcaption align="middle">s= 16.</figcaption>
                    </br>
                    <br>
                        <td align="middle">
                        <img src="part4/spheres_s64.png" width="480px" />
                        <figcaption align="middle">s= 64.</figcaption>
                    </br>
                </tr>
                <tr>
                    <br>
                        <td align="middle">
                        <img src="part4/spheres1024.png" width="480px" />
                        <figcaption align="middle">s = 1024.</figcaption>
                    </br>
                </tr>
            </table>
        </div>
       

        <h2 align="middle">Part 5: Adaptive Sampling</h2>

        <p>implementation of the adaptive sampling:</p>
    
        <p>I keep track of the variance and when the variance is small thaner than the 
            max_tolerance*mu, I have enough confidence that the pixel value is good enough to exit the loop. </p>
        <p> 
            bunny.dae with the sampling rate image.
        </p>
            <div align="center">
            <table style="width=100%">
                <tr>
                    <br>
                        <td align="middle">
                        <img src="q5/bunny.png" width="480px" />
                        <figcaption align="middle">Bunny.</figcaption>
                    </br>
                    <br>
                        <td align="middle">
                        <img src="q5/bunny_rate.png" width="480px" />
                        <figcaption align="middle">Bunny rate.</figcaption>
                    </br>
                </tr>
            </table>
        </div>








    <h2 align="middle">A Few Notes On Webpages</h2>
        <p>Here are a few problems students have encountered in the past. You will probably encounter these problems at some point, so don't wait until right before the deadline to check that everything is working. Test your website on the instructional machines early!</p>
        <ul>
        <li>Your main report page should be called index.html.</li>
        <li>Be sure to include and turn in all of the other files (such as images) that are linked in your report!</li>
        <li>Use only <em>relative</em> paths to files, such as <pre>"./images/image.jpg"</pre>
        Do <em>NOT</em> use absolute paths, such as <pre>"/Users/student/Desktop/image.jpg"</pre></li>
        <li>Pay close attention to your filename extensions. Remember that on UNIX systems (such as the instructional machines), capitalization matters. <pre>.png != .jpeg != .jpg != .JPG</pre>
        <li>Be sure to adjust the permissions on your files so that they are world readable. For more information on this please see this tutorial: <a href="http://www.grymoire.com/Unix/Permissions.html">http://www.grymoire.com/Unix/Permissions.html</a></li>
        <li>And again, test your website on the instructional machines early!</li>
</div>
</body>
</html>




